name: iOS Build
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      # 1. 核心步骤：修正 Scheme 名称
      - name: Build App
        run: |
          xcodebuild build \
            -scheme TarkovPlayerStats \
            -destination 'generic/platform=iOS' \
            -configuration Release \
            -derivedDataPath build \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGN_ENTITLEMENTS="" \
            CODE_SIGNING_METHOD=adhoc

      # 2. 将编译产物打包成 .ipa 格式（AltStore 识别格式）
      - name: Package IPA
        run: |
          mkdir -p Payload
          find build/Build/Products/Release-iphoneos -name "*.app" -exec cp -r {} Payload/ \;
          zip -r TarkovStats.ipa Payload

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tarkov-stats-ipa
          path: TarkovStats.ipa
