name: iOS Build
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      # 1. 核心步骤：使用 xcodebuild 编译 Swift 项目
      # 注意：由于没有付费证书，我们只做编译生成 .app，后续由 AltStore 签名
      - name: Build App
        run: |
          xcodebuild build \
            -scheme rork-tarkov-player-stats \
            -destination 'generic/platform=iOS' \
            -configuration Release \
            -derivedDataPath build

      # 2. 将编译产物打包成 .ipa 格式（AltStore 识别格式）
      - name: Package IPA
        run: |
          mkdir -p Payload
          cp -r build/Build/Products/Release-iphoneos/*.app Payload/
          zip -r YourApp.ipa Payload

      # 3. 上传结果 (已更新为 v4)
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: tarkov-stats-ipa
          path: MyTarkov.ipa
